
<div class="container">
	<div class="row">
		<%= render "books/user_create", user: @user  %>

		<div class="col-xs-9">
			<h2>Books</h2>
			<table class="table table-hover table-inverse">
				<thead>
					<tr>
						<th></th>
						<th>Title</th>
						<th>Opinion</th>
						<th colspan="3"></th>
					</tr>
				</thead>
				<tbody>
					<% @books.each do |book| %>
						<tr>
							<td><%= link_to user_path(book.user.id) do %>
								<%= attachment_image_tag @user, :profile_image, size:"40x40", fallback: "no_image.jpg" %>
								<br>
								<%= @user.name%>
								<% end %>

							</td>
							<td>
								<%= link_to "#{book.title}", book_path(book.id) %>
							</td>
							<td><%= book.body %></td>
							<td>コメント数：<%= book.book_comments.count %></td>
							<% if book.user == current_user %>
								<td><%= link_to "edit", edit_book_path(book), class:"btn-sm btn-success" %></td>
								<td><%= link_to "destroy", book_path(book), method: :delete, data:{confirm:"本当に消しますか？"}, class:"btn-sm btn-danger"  %></td>
							<% end %>
						</tr>
					<% end %>
				</tbody>
			</table>
		</div>
	</div><!--row-->

	<% if @user == current_user %>
		<div class="row">
			<h2>Your MAP</h2>
			<script type="text/javascript">
				function initMap() {
					var test ={
						lat: <%= @user.latitude %>, lng: <%= @user.longitude %>
					};
					var map = new google.maps.Map(document.getElementById("map"), {
							zoom: 15,
							center: test
						});
					var transitLayer = new google.maps.TransitLayer();
					transitLayer.setMap(map);

					var contentString = "住所: <%= @user.address_street %>";
					var infoWindow = new google.maps.InfoWindow({
						content: contentString
					});

					var marker = new google.maps.marker({
						position: test,
						map: map,
						title: contentString
					});

					marker.addListener("click", function(){
						infoWindow.open(map, marker)
					});
				}
			</script>

			<script async defer
				 src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=<%= ENV['GOOGLE_MAP_API_KEY'] %>&callback=initMap">
			</script>

			<style type="text/css">
  				#map { height: 300px;
         				width: 60%;}
			</style>

			<div id="map"></div>
		</div><!--map row-->
	<% end %>
</div>

